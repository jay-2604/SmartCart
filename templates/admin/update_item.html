{% extends "admin/base.html" %}

{% block title %}Update {{ product.name }} - Admin{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      
      <!-- Header -->
      <div class="text-center mb-4">
        <i class="bi bi-pencil-square text-warning" style="font-size: 3rem;"></i>
        <h2 class="fw-bold mt-3">Update Product</h2>
        <p class="text-muted">Modify product details and save changes</p>
      </div>

      <!-- Update Form Card -->
      <div class="card shadow-lg border-0">
        <div class="card-body p-5">
          <form method="POST" action="/admin/update-item/{{ product.product_id }}" enctype="multipart/form-data">
            
            <!-- Product Name -->
            <div class="mb-4">
              <label for="name" class="form-label fw-semibold">
                <i class="bi bi-tag me-2"></i>Product Name
              </label>
              <input type="text" 
                     class="form-control form-control-lg" 
                     id="name" 
                     name="name" 
                     value="{{ product.name }}"
                     required>
            </div>

            <!-- Description -->
            <div class="mb-4">
              <label for="description" class="form-label fw-semibold">
                <i class="bi bi-file-text me-2"></i>Description
              </label>
              <textarea class="form-control" 
                        id="description" 
                        name="description" 
                        rows="4" 
                        required>{{ product.description }}</textarea>
            </div>

            <!-- Category, Price and Quantity Row -->
            <div class="row mb-4">
              <div class="col-md-4">
                <label for="category" class="form-label fw-semibold">
                  <i class="bi bi-grid me-2"></i>Category
                </label>
                <input type="text" 
                       class="form-control form-control-lg" 
                       id="category" 
                       name="category" 
                       value="{{ product.category }}"
                       required>
              </div>

              <div class="col-md-4">
                <label for="price" class="form-label fw-semibold">
                  <i class="bi bi-currency-rupee me-2"></i>Price
                </label>
                <div class="input-group input-group-lg">
                  <span class="input-group-text">â‚¹</span>
                  <input type="number" 
                         class="form-control" 
                         id="price" 
                         name="price" 
                         step="0.01" 
                         min="0"
                         value="{{ product.price }}"
                         required>
                </div>
              </div>

              <div class="col-md-4">
                <label for="quantity" class="form-label fw-semibold">
                  <i class="bi bi-123 me-2"></i>Quantity in Stock
                </label>
                <input type="number"
                       class="form-control form-control-lg"
                       id="quantity"
                       name="quantity"
                       min="0"
                       value="{{ product.quantity }}"
                       required>
              </div>
            </div>

            <!-- Current Image Display -->
            <div class="mb-4">
              <label class="form-label fw-semibold">
                <i class="bi bi-image me-2"></i>Current Product Image
              </label>
              <div class="card bg-light">
                <div class="card-body text-center p-4">
                  <img src="/static/uploads/product_images/{{ product.image }}" 
                       class="img-thumbnail shadow-sm" 
                       style="max-height: 200px; object-fit: contain;"
                       alt="{{ product.name }}">
                </div>
              </div>
            </div>

            <!-- New Image Upload -->
            <div class="mb-4">
              <label for="image" class="form-label fw-semibold">
                <i class="bi bi-cloud-upload me-2"></i>Upload New Image (Optional)
              </label>
              <input type="file" 
                     class="form-control form-control-lg" 
                     id="image" 
                     name="image" 
                     accept="image/*">
              <small class="form-text text-muted">Leave empty to keep the current image</small>
              
              <!-- New Image Preview -->
              <div id="newImagePreview" class="mt-3 text-center" style="display: none;">
                <p class="text-muted small mb-2">New Image Preview:</p>
                <img id="preview" src="" alt="Preview" class="img-thumbnail" style="max-height: 200px;">
              </div>
            </div>

            <!-- Buttons -->
            <div class="d-flex gap-3">
              <button type="submit" class="btn btn-warning btn-lg flex-grow-1">
                <i class="bi bi-check-circle me-2"></i>Update Product
              </button>
              <a href="/admin/item-list" class="btn btn-outline-secondary btn-lg">
                <i class="bi bi-x-circle me-2"></i>Cancel
              </a>
            </div>
          </form>
        </div>
      </div>

      <!-- Navigation Links -->
      <div class="d-flex justify-content-between mt-4">
        <a href="/admin/view-item/{{ product.product_id }}" class="text-decoration-none">
          <i class="bi bi-eye me-2"></i>View Product Details
        </a>
        <a href="/admin/item-list" class="text-decoration-none">
          <i class="bi bi-arrow-left me-2"></i>Back to Product List
        </a>
      </div>

    </div>
  </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<script>
// New Image Preview
document.getElementById('image').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('preview').src = e.target.result;
      document.getElementById('newImagePreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
  } else {
    document.getElementById('newImagePreview').style.display = 'none';
  }
});
</script>
{% endblock %}
